<!doctype html>
<html lang="en">
<head>
<title>MQTT Publish </title>
<script src="https://cdnjs.cloudflare.com/ajax/libs/paho-mqtt/1.0.1/mqttws31.js" type="text/javascript"></script>
<!-- Required meta tags -->
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

<!-- Bootstrap CSS -->
<link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.4.1/css/bootstrap.min.css" integrity="sha384-Vkoo8x4CGsO3+Hhxv8T/Q5PaXtkKtu6ug5TOeNV6gBiFeWPGFN9MuhOf23Q9Ifjh" crossorigin="anonymous">

</head>
<body>
    <center>
    <div class="container">
        <div class="tab-content grid">
            <h1>Bandung Weather News (input)</h1>
            <form>
                <div class="form-group row">
                  <label for="colFormLabelSm" class="col-sm-2 col-form-label col-form-label-sm">Hostname</label>
                  <div class="col-sm-10">
                    <input type="text" class="form-control form-control-sm" id="mqtt_server" value="broker.hivemq.com">
                  </div>
                </div>
                <div class="form-group row">
                    <label for="colFormLabelSm" class="col-sm-2 col-form-label col-form-label-sm">Port</label>
                    <div class="col-sm-10">
                      <input type="text" class="form-control form-control-sm" id="mqtt_port" value="8000">
                    </div>
                </div>
                <div class="form-group row">
                    <label for="colFormLabelSm" class="col-sm-2 col-form-label col-form-label-sm">Topic</label>
                    <div class="col-sm-10">
                      <input type="text" class="form-control form-control-sm"  id="mqtt_destname" value="suhuBDG">
                    </div>
                </div>
                <div class="form-group row">
                    <label for="colFormLabelSm" class="col-sm-2 col-form-label col-form-label-sm">Sensor 1</label>
                    <div class="col-sm-10">
                      <input type="text" class="form-control form-control-sm" id="mqtt_msg1" value="">
                    </div>
                </div>
                <div class="form-group row">
                    <label for="colFormLabelSm" class="col-sm-2 col-form-label col-form-label-sm">Sensor 2</label>
                    <div class="col-sm-10">
                      <input type="text" class="form-control form-control-sm" id="mqtt_msg2" value="">
                    </div>
                </div>
                <div class="form-group row">
                    <label for="colFormLabelSm" class="col-sm-2 col-form-label col-form-label-sm">Sensor 3</label>
                    <div class="col-sm-10">
                      <input type="text" class="form-control form-control-sm" id="mqtt_msg3" value="">
                    </div>
                </div>
              </form>
            <input type="button" class="btn btn-primary" id="publish_now" onclick="send_mqtt_msg()" value="Send Data">
            <div id="pubmsg"></div>
    <script>
        // Define some MQTT variables
        var mqtt_server = "";
        var mqtt_port = "";
        var mqtt_destname = "";
        var mqtt_msg1 ="";
        var mqtt_msg2 ="";
        var mqtt_msg3 ="";

        function send_mqtt_msg() {
            // Send an MQTT message
            mqtt_server = document.getElementById("mqtt_server").value;
            mqtt_port = Number(document.getElementById("mqtt_port").value);


            client = new Paho.MQTT.Client(mqtt_server, mqtt_port,"");
            client.connect({onSuccess:onConnect});
            document.getElementById("pubmsg").innerHTML = "Trying to connect...";
        }

        function onConnect() {
            document.getElementById("pubmsg").innerHTML = "New connection made...";
            var mqtt_destname = document.getElementById("mqtt_destname").value;
            var mqtt_msg1 = document.getElementById("mqtt_msg1").value;
            var mqtt_msg2 = document.getElementById("mqtt_msg2").value;
            var mqtt_msg3 = document.getElementById("mqtt_msg3").value;
            var mqtt_msg = mqtt_msg1 + " | " + mqtt_msg2+ " | " + mqtt_msg3;
            message = new Paho.MQTT.Message(mqtt_msg);
            message.destinationName = mqtt_destname;
            client.send(message);
            document.getElementById("pubmsg").innerHTML = "Bandung Weather Data: " + mqtt_msg + "      ...sent";
        }
        // called when a message arrives

    </script>
            </div>
        </div>
    </center>
</body>
</html>
<style>
    .container {
        padding: 5px;
    }
    .tab-content{
    /* position: center; */
    width: 600px;
    height: 530px;
    /* margin-top: 70px; */
    /* margin-left: 250px; */
    background: #fff;
    color: #000;
    border-radius: 30px;
    /* z-index: 1000; */
    box-shadow: 0px 10px 10px rgba(0, 0, 0, 0.4);
    padding : 30px;
    margin-top: 20px;
    }
    #pubmsg{
      padding-top: 20px;
      color: blue;
    }

</style>
